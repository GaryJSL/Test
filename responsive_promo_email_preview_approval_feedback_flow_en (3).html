<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Promo Email Preview • Regeneration Health</title>
  <style>
    :root {
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --brand: #fb923c;         /* CTA orange */
      --brand-hover: #f97316;   /* CTA hover */
      --approve: #3b82f6;       /* blue approve */
      --approve-600: #2563eb;
      --reject: #ef4444;        /* red reject */
      --success: #22c55e;       /* green toast */
      --shadow: 0 10px 24px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.05);
      --ring: rgba(37,99,235,.25);
      --radius: 20px;
    }

    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--ink); line-height: 1.55;
      background: linear-gradient(180deg, #f7fbff 0%, #eef2ff 100%); }
    .wrap { max-width: 1024px; margin: 0 auto; padding: 24px; }

    /* Top logo */
    .brand { display:flex; justify-content:center; align-items:center; margin-bottom: 18px; }
    .brand img{ height: 40px; width:auto; }

    /* Email preview card */
    .email-card { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
    .email-body { padding: 22px; }

    /* Vertical promo blocks */
    .promos{ display:flex; flex-direction:column; gap:24px; }
    .promo{ display:flex; flex-direction:column; gap:16px; align-items:center; text-align:center; padding:24px; border-radius:20px; box-shadow: var(--shadow); }
    .promo-media img{ width:100%; height:auto; display:block; object-fit:cover; aspect-ratio: 16/9; border-radius:16px; }
    .promo-copy h2{ font-size:clamp(20px, 2.2vw, 28px); margin:0 0 8px; line-height:1.2; font-weight:900; }
    .promo-copy p{ color:var(--muted); margin:0 0 12px; }
    .promo-copy ul{ list-style:none; padding:0; margin:8px 0 12px; text-align:left; }
    .promo-copy ul li{ margin:6px 0; }
    .promo-copy ul li::before{ content:'✅ '; }
    .promo-cta{ display:flex; justify-content:center; }
    .cta-btn{ display:inline-block; background:var(--brand); color:#fff; text-decoration:none; padding:14px 28px; border-radius:9999px; font-weight:800; box-shadow:var(--shadow); }
    .cta-btn:hover{ background:var(--brand-hover); }
    .cta-btn:focus{ outline:3px solid var(--ring); outline-offset:2px; }

    /* Soft themed backgrounds for modules */
    .theme-warm{ background:#fff7ed; /* orange-50 */ }
    .theme-cool{ background:#eff6ff; /* blue-50   */ }
    .theme-mint{ background:#ecfdf5; /* green-50  */ }

    /* Approve/Reject card */
    .panel{ margin-top:26px; text-align:center; }
    .panel-actions{ display:inline-flex; flex-direction:column; align-items:center; background:var(--card); padding:20px 26px; border-radius:20px; box-shadow:var(--shadow); max-width:600px; margin:auto; }
    .panel-actions span{ margin-bottom:14px; font-weight:600; color:var(--muted); }
    .btn{ border:none; border-radius:12px; padding:12px 24px; font-weight:800; color:#fff; cursor:pointer; margin:0 8px; box-shadow:var(--shadow); }
    .btn-approve{ background:var(--approve); }
    .btn-approve:hover{ background:var(--approve-600); }
    .btn-reject{ background:var(--reject); }

    /* Comment drawer */
    .drawer { position:sticky; bottom:0; background:var(--card); border-radius:22px 22px 0 0; box-shadow:0 -16px 40px rgba(0,0,0,.12); border:1px solid #e5e7eb; padding:16px; margin-top:18px; display:none; max-width:100%; box-sizing:border-box; }
    .drawer.active{ display:block; }
    .drawer-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .drawer-title{ font-weight:900; }
    .icon-btn{ background:transparent; border:none; cursor:pointer; padding:8px; border-radius:10px; }
    .icon-btn:hover{ background:#f3f4f6; }
    .drawer-body{ margin-top:10px; }
    .textarea{ width:100%; max-width:100%; box-sizing:border-box; min-height:120px; resize:vertical; padding:12px 14px; border:1px solid #d1d5db; border-radius:12px; font:inherit; }
    .textarea::placeholder{ color:#9ca3af; }
    .helper{ font-size:.95rem; color:var(--muted); margin-top:8px; }
    .drawer-actions{ display:flex; justify-content:flex-end; gap:12px; margin-top:14px; flex-wrap:wrap; }
    .btn-muted{ background:#f3f4f6; color:#111827; }
    .btn-confirm{ background:var(--reject); color:#fff; }
    .btn-confirm[disabled]{ opacity:.55; cursor:not-allowed; position:relative; }
    .btn-confirm[disabled][data-tooltip]:hover::after{ content:attr(data-tooltip); position:absolute; bottom:calc(100% + 10px); left:50%; transform:translateX(-50%); background:#111827; color:#fff; padding:8px 10px; border-radius:8px; font-size:.85rem; white-space:nowrap; box-shadow:var(--shadow); }
    .btn-confirm[disabled][data-tooltip]:hover::before{ content:""; position:absolute; bottom:100%; left:50%; transform:translateX(-50%); border:6px solid transparent; border-top-color:#111827; }

    /* --- Keyboard-safe mobile behavior --- */
    .drawer{ padding-bottom: calc(16px + env(safe-area-inset-bottom)); }
    .drawer.mobile-fixed{ position: fixed; left: 0; right: 0; bottom: 0; z-index:55; }
    @media (max-width:640px){
      .drawer.active, .drawer.mobile-fixed{ max-height: 55svh; overflow:auto; }
    }
    @supports (height: 1dvh){
      @media (max-width:640px){
        .drawer.active, .drawer.mobile-fixed{ max-height: 55dvh; }
      }
    }

    /* Modals */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(17,24,39,.55); padding:20px; z-index:60; }
    .modal[aria-hidden="false"]{ display:flex; }
    .modal-card{ background:var(--card); border-radius:20px; box-shadow:var(--shadow); width:min(560px,92vw); overflow:hidden; }
    .modal-head{ padding:16px 18px; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; justify-content:space-between; }
    .modal-title{ font-weight:900; }
    .modal-body{ padding:18px; }
    .modal-actions{ padding:10px 18px 20px; display:flex; gap:14px; justify-content:flex-end; }
    .circle-btn{ width:56px; height:56px; border-radius:9999px; border:none; font-weight:900; letter-spacing:.5px; cursor:pointer; box-shadow:0 12px 26px rgba(0,0,0,.10), 0 2px 6px rgba(0,0,0,.06); }
    .circle-neutral{ background:#f3f4f6; color:#111827; }
    .circle-primary{ background:var(--approve); color:#fff; }
    .circle-primary:hover{ background:var(--approve-600); }

    .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:16px; background:var(--success); color:#fff; padding:10px 16px; border-radius:9999px; box-shadow:var(--shadow); z-index:70; opacity:0; transition:opacity .2s ease; }
    .toast.show{ opacity:1; }

    /* Remove conflicting older rule to avoid overriding 55svh */
    @media (max-width: 640px){
      .email-body{ padding:18px; }
      .drawer{ padding:14px; }
      .textarea{ min-height:100px; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <!-- Page top centered client logo -->
    <div class="brand"><img src="https://via.placeholder.com/160x40.png?text=Client+Logo" alt="Client Logo" /></div>

    <!-- Email preview with vertical promos -->
    <article class="email-card">
      <div class="email-body">
        <section class="promos">
          <!-- Promo 1 -->
          <div class="promo theme-warm">
            <div class="promo-media">
              <img src="sandbox:/mnt/data/promo1.png" alt="Patient on laptop during GLP-1 telehealth consult" />
            </div>
            <div class="promo-copy">
              <h2>Lose Weight. Gain Health.  Start Today with GLP-1 Telehealth!</h2>
              <p>Struggling to lose weight? Diets and workouts alone don’t always deliver the results you want. That’s why Regeneration Health is excited to introduce our GLP-1 Telehealth Weight Loss Program — a safe, effective solution designed to fit your lifestyle.</p>
              <ul>
                <li>$299 first telehealth visit (includes 30 days of medication)</li>
                <li>Doctor-supervised, prescription-based treatment</li>
                <li>Convenient telehealth appointments from home</li>
                <li>Limited availability this month</li>
              </ul>
              <p>It’s time to take control of your weight — and your health.</p>
            </div>
            <div class="promo-cta"><a class="cta-btn" href="https://regenerationhealth.eremanagement.com/1/?_kx=mawlxFwFYUDsDp4pRbbz1rgx_yO5Mseb6gk-aQbD1-g.V7gQXT" target="_blank" rel="noopener">Get Appointment Now</a></div>
          </div>

          <!-- Promo 2 -->
          <div class="promo theme-cool">
            <div class="promo-media">
              <img src="sandbox:/mnt/data/promo2.png" alt="Telehealth appointment on laptop with clinician" />
            </div>
            <div class="promo-copy">
              <h2>Transform Your Health with GLP-1 Telehealth</h2>
              <p>Join our GLP-1 Telehealth Weight Loss Program for life-changing results from home. Limited slots available for personalized care. Book your telehealth appointment today.</p>
            </div>
            <div class="promo-cta"><a class="cta-btn" href="https://regenerationhealth.eremanagement.com/1/?_kx=mawlxFwFYUDsDp4pRbbz1rgx_yO5Mseb6gk-aQbD1-g.V7gQXT" target="_blank" rel="noopener">Get Appointment Now</a></div>
          </div>

          <!-- Promo 3 -->
          <div class="promo theme-mint">
            <div class="promo-media">
              <img src="sandbox:/mnt/data/promo3.png" alt="At-home wellness and HRT telehealth" />
            </div>
            <div class="promo-copy">
              <h2>Convenient Hormone Replacement Therapy</h2>
              <p>Experience Hormone Replacement Therapy via telehealth for balanced hormones. Ideal for those experiencing menopausal symptoms, improved energy, and bone health. Start with a virtual consultation.</p>
            </div>
            <div class="promo-cta"><a class="cta-btn" href="https://regenerationhealth.eremanagement.com/1/?_kx=mawlxFwFYUDsDp4pRbbz1rgx_yO5Mseb6gk-aQbD1-g.V7gQXT" target="_blank" rel="noopener">Get Appointment Now</a></div>
          </div>
        </section>
      </div>
    </article>

    <!-- Approve / Reject panel (unchanged) -->
    <section class="panel">
      <div class="panel-actions">
        <span>Did you like this email?</span>
        <div>
          <button class="btn btn-approve" id="approveBtn">Approve</button>
          <button class="btn btn-reject" id="rejectBtn">Reject</button>
        </div>
      </div>
    </section>

    <!-- Comment Drawer -->
    <section id="drawer" class="drawer" aria-live="polite" aria-hidden="true">
      <header class="drawer-head">
        <div class="drawer-title">Comment <span aria-hidden="true" style="color:#ef4444">*</span></div>
        <div>
          <button id="collapseBtn" class="icon-btn" type="button" aria-expanded="true" aria-controls="drawerBody" title="Collapse/expand">▲</button>
          <button id="closeDrawerBtn" class="icon-btn" type="button" aria-label="Close comment box">✕</button>
        </div>
      </header>
      <div id="drawerBody" class="drawer-body">
        <textarea id="commentInput" class="textarea" placeholder="Provide feedback that will help us improve our next draft."></textarea>
        <p class="helper">Feedback is required to confirm rejection.</p>
        <div class="drawer-actions">
          <button class="btn btn-muted" id="cancelDrawer" type="button">Cancel</button>
          <button id="confirmRejectBtn" class="btn btn-confirm" type="button" disabled data-tooltip="Please provide your feedback.">Confirm to reject</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Approve confirm modal (N / Y round buttons) -->
  <div id="approveModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="approveTitle">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title" id="approveTitle">Confirm Approval?</div>
        <button class="icon-btn" data-close-modal="approveModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">Confirm approval? Once approved, it will be sent to the target audience.</div>
      <div class="modal-actions">
        <button class="circle-btn circle-neutral" data-close-modal="approveModal" aria-label="No">N</button>
        <button id="approveYes" class="circle-btn circle-primary" aria-label="Yes">Y</button>
      </div>
    </div>
  </div>

  <!-- Feedback submitted modal (after Confirm to reject) -->
  <div id="thanksModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="thanksTitle">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title" id="thanksTitle">Feedback Submitted</div>
        <button class="icon-btn" data-close-modal="thanksModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">"Thank you! Your feedback has been successfully submitted. We will review your comments and get back to you with an updated draft."</div>
      <div class="modal-actions">
        <button class="btn btn-approve" data-close-modal="thanksModal">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const approveBtn = document.getElementById('approveBtn');
    const rejectBtn = document.getElementById('rejectBtn');
    const drawer = document.getElementById('drawer');
    const closeDrawerBtn = document.getElementById('closeDrawerBtn');
    const cancelDrawer = document.getElementById('cancelDrawer');
    const collapseBtn = document.getElementById('collapseBtn');
    const drawerBody = document.getElementById('drawerBody');
    const commentInput = document.getElementById('commentInput');
    const confirmRejectBtn = document.getElementById('confirmRejectBtn');

    const approveModal = document.getElementById('approveModal');
    const thanksModal = document.getElementById('thanksModal');

    // Helpers for mobile + keyboard
    const isMobile = () => window.matchMedia('(max-width: 768px)').matches;
    function adjustForKeyboard(){
      const vv = window.visualViewport;
      if(!vv) return;
      const bottomInset = Math.max(0, (window.innerHeight - vv.height - vv.offsetTop));
      if (drawer.classList.contains('active')) {
        drawer.style.bottom = bottomInset + 'px';
      }
    }
    function openDrawerMobileAware(){
      // Always reset to expanded state on open
      drawerBody.style.display = '';
      collapseBtn.textContent = '▲';
      collapseBtn.setAttribute('aria-expanded','true');

      drawer.classList.add('active');
      drawer.setAttribute('aria-hidden','false');
      if (isMobile()) drawer.classList.add('mobile-fixed');
      adjustForKeyboard();
      setTimeout(()=>{
        try { commentInput.focus({preventScroll:true}); } catch(e) {}
        commentInput.scrollIntoView({block:'center', behavior:'smooth'});
      }, 80);
    }
    if (window.visualViewport){
      visualViewport.addEventListener('resize', adjustForKeyboard);
      visualViewport.addEventListener('scroll', adjustForKeyboard);
    }
    commentInput.addEventListener('focus', ()=>{ if(isMobile()){ drawer.classList.add('mobile-fixed'); adjustForKeyboard(); } });
    commentInput.addEventListener('blur', ()=>{ drawer.style.bottom='0px'; drawer.classList.remove('mobile-fixed'); });

    const openModal = (el) => el.setAttribute('aria-hidden','false');
    const closeModal = (el) => el.setAttribute('aria-hidden','true');

    // Approve flow
    approveBtn.addEventListener('click', () => openModal(approveModal));
    document.getElementById('approveYes').addEventListener('click', () => {
      closeModal(approveModal);
      showToast('Approved and queued for sending.');
    });

    // close any modal via data-close-modal
    document.querySelectorAll('[data-close-modal]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = e.currentTarget.getAttribute('data-close-modal');
        const el = document.getElementById(id);
        if (el) closeModal(el);
      });
    });

    // Reject flow (fixed)
    rejectBtn.addEventListener('click', openDrawerMobileAware);

    commentInput.addEventListener('input', () => {
      confirmRejectBtn.disabled = commentInput.value.trim().length === 0;
    });

    const closeDrawer = () => {
      drawer.classList.remove('active','mobile-fixed');
      drawer.setAttribute('aria-hidden','true');
      drawer.style.bottom='0px';
      // Reset collapsed state so next open is full
      drawerBody.style.display = '';
      collapseBtn.textContent='▲';
      collapseBtn.setAttribute('aria-expanded','true');
      // Reset content & state
      commentInput.value='';
      confirmRejectBtn.disabled = true;
    };
    closeDrawerBtn.addEventListener('click', closeDrawer);
    cancelDrawer.addEventListener('click', closeDrawer);

    collapseBtn.addEventListener('click', () => {
      const isHidden = drawerBody.style.display === 'none';
      drawerBody.style.display = isHidden ? '' : 'none';
      collapseBtn.textContent = isHidden ? '▲' : '▼';
      collapseBtn.setAttribute('aria-expanded', String(isHidden));
    });

    // Confirm to reject -> show feedback submitted modal
    confirmRejectBtn.addEventListener('click', () => {
      if (confirmRejectBtn.disabled) return;
      openModal(thanksModal);
      closeDrawer();
    });

    // Toast helper
    function showToast(msg){
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      document.body.appendChild(t);
      requestAnimationFrame(()=> t.classList.add('show'));
      setTimeout(()=> { t.classList.remove('show'); setTimeout(()=> t.remove(), 200); }, 2400);
    }

    // Accessibility: close modals when clicking backdrop or pressing Escape
    ;[approveModal, thanksModal].forEach(m => m.addEventListener('click', (e)=>{ if(e.target===m) closeModal(m); }));
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ closeModal(approveModal); closeModal(thanksModal); }});

    // --- Smoke tests (non-blocking) ---
    (function runSmokeTests(){
      try{
        console.assert(document.getElementById('approveBtn'), 'Approve button should exist');
        console.assert(document.getElementById('rejectBtn'), 'Reject button should exist');
        console.assert(document.getElementById('approveModal'), 'Approve modal should exist');
        console.assert(document.getElementById('thanksModal'), 'Thanks modal should exist');
        console.assert(document.getElementById('confirmRejectBtn').disabled === true, 'Confirm-to-reject should start disabled');
        // Simulate typing to enable confirm
        commentInput.value = 'test';
        commentInput.dispatchEvent(new Event('input'));
        console.assert(document.getElementById('confirmRejectBtn').disabled === false, 'Confirm-to-reject should enable after typing');
        // Reset
        commentInput.value = '';
        commentInput.dispatchEvent(new Event('input'));
        console.assert(document.getElementById('confirmRejectBtn').disabled === true, 'Confirm-to-reject should disable when empty again');
      }catch(e){ console.warn('Smoke tests warning:', e); }
    })();

    // Extra test: collapse -> close -> reopen should be expanded
    (function testReopenExpanded(){
      setTimeout(()=>{
        try{
          openDrawerMobileAware();
          collapseBtn.click(); // collapse
          closeDrawer();       // close
          openDrawerMobileAware(); // reopen
          console.assert(drawerBody.style.display !== 'none', 'Drawer should reopen expanded by default');
          console.assert(collapseBtn.getAttribute('aria-expanded') === 'true', 'Arrow aria-expanded should reset to true on reopen');
          closeDrawer();
        }catch(e){ console.warn('Reopen test warning:', e); }
      }, 150);
    })();
  </script>
</body>
</html>
